node {
   stage('Cleanup Branch') {
    // Trigger: GitHub webhook whenever a branch is deleted
    // Action: Delete branch's testing channels and containers

    withCredentials([string(credentialsId: 'DISCORD_DEV_TOKEN', variable: 'token')]) {
        // Parse the GitHub webhook's payload
        def object = readJSON text: "${payload}"
        def branch_name = object.ref
        sh "mkdir wall_e"
        sh "cd wall_e"
        sh "git init"
        sh "git remote add origin https://github.com/CSSS/wall_e.git"
        sh "git fetch --depth 1 origin"
        sh "git checkout master"
        sh "./CI/server_scripts/clean_branch/clear_branch_env.sh \"${branch_name}\" \"${token}\""
        sh "cd ../"
        sh "rm -fr wall_e"
    }
   }
}
